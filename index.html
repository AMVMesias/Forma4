<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrar Gastos - Básico</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
    .error { color: red; font-size: 0.9em; display: none; }
    .success { color: green; font-size: 1em; margin-top: 20px; display: none; }
    #history { margin-top: 30px; }
    #historyList { list-style: none; padding-left: 0; }
    #historyList li { background: #f5f5f5; margin-bottom: 5px; padding: 10px; }
  </style>
</head>
<body>
  <h1>Registrar Nuevo Gasto</h1>
  <form id="expenseForm">
    <div class="form-group">
      <label for="expenseDate">Fecha del Gasto</label>
      <input type="date" id="expenseDate" required>
      <div class="error" id="dateError">La fecha es obligatoria.</div>
    </div>
    <div class="form-group">
      <label for="expenseCategory">Categoría</label>
      <select id="expenseCategory" required>
        <option value="">Seleccione una categoría</option>
        <option value="transporte">Transporte</option>
        <option value="alimentacion">Alimentación</option>
        <option value="hospedaje">Hospedaje</option>
        <option value="materiales">Materiales</option>
        <option value="servicios">Servicios</option>
        <option value="equipos">Equipos</option>
        <option value="otros">Otros</option>
      </select>
      <div class="error" id="categoryError">Seleccione una categoría.</div>
    </div>
    <div class="form-group">
      <label for="expenseAmount">Monto</label>
      <input type="number" id="expenseAmount" step="0.01" required placeholder="0.00">
      <div class="form-text">Valor entre 0.01 y 10000.</div>
      <div class="error" id="amountError">Ingrese un monto válido (máximo 10000).</div>
    </div>
    <div class="form-group">
      <label for="invoiceNumber">Número de Factura</label>
      <input type="text" id="invoiceNumber" maxlength="9" required placeholder="Ej: 123456789">
      <div class="form-text">Exactamente 9 dígitos numéricos.</div>
      <div class="error" id="invoiceError">Debe tener 9 dígitos.</div>
    </div>
    <div class="form-group">
      <label for="providerRuc">RUC del Proveedor</label>
      <input type="text" id="providerRuc" maxlength="13" required placeholder="Ej: 1234567890123">
      <div class="form-text">Exactamente 13 dígitos numéricos.</div>
      <div class="error" id="rucError">Debe tener 13 dígitos.</div>
    </div>
    <div class="form-group">
      <label for="responsibleCedula">Cédula del Responsable</label>
      <input type="text" id="responsibleCedula" maxlength="10" required placeholder="Ej: 1234567890">
      <div class="form-text">Exactamente 10 dígitos numéricos.</div>
      <div class="error" id="cedulaError">Debe tener 10 dígitos.</div>
    </div>
    <div class="form-group">
      <label for="expenseFile">Comprobante (PDF, PNG, JPG)</label>
      <input type="file" id="expenseFile" accept=".pdf,.png,.jpg,.jpeg" required>
      <div class="form-text">Formatos permitidos: PDF, PNG, JPG.</div>
      <div class="error" id="fileError">Seleccione un archivo con formato PDF, PNG o JPG.</div>
    </div>
    <button type="submit">Registrar Gasto</button>
  </form>

  <div class="success" id="successMessage">Registro exitoso. Historial actualizado.</div>

  <div id="history">
    <h2>Historial de Gastos</h2>
    <ul id="historyList"></ul>
  </div>

  <script>
    const form = document.getElementById('expenseForm');
    const historyList = document.getElementById('historyList');
    const successMsg = document.getElementById('successMessage');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      clearErrors();

      const date = document.getElementById('expenseDate').value;
      const category = document.getElementById('expenseCategory').value;
      const amount = document.getElementById('expenseAmount').value;
      const invoice = document.getElementById('invoiceNumber').value.trim();
      const ruc = document.getElementById('providerRuc').value.trim();
      const cedula = document.getElementById('responsibleCedula').value.trim();
      const fileInput = document.getElementById('expenseFile');
      const file = fileInput.files[0];

      let valid = true;

      if (!date) { showError('dateError'); valid = false; }
      if (!category) { showError('categoryError'); valid = false; }
      if (!amount || isNaN(amount) || Number(amount) <= 0 || Number(amount) > 10000) { showError('amountError'); valid = false; }
      if (invoice.length !== 9) { showError('invoiceError'); valid = false; }
      if (ruc.length !== 13) { showError('rucError'); valid = false; }
      if (cedula.length !== 10) { showError('cedulaError'); valid = false; }
      if (!file || !['application/pdf', 'image/png', 'image/jpeg'].includes(file.type)) {
        showError('fileError'); valid = false;
      }

      if (!valid) return;

      // Actualizar historial
      const item = document.createElement('li');
      item.textContent = `${date} | ${category} | $${parseFloat(amount).toFixed(2)} | Factura: ${invoice}`;
      historyList.appendChild(item);

      successMsg.style.display = 'block';
      form.reset();
    });

    function showError(id) {
      document.getElementById(id).style.display = 'block';
    }
    function clearErrors() {
      document.querySelectorAll('.error').forEach(el => el.style.display = 'none');
      successMsg.style.display = 'none';
    }
  </script>
</body>
</html>
